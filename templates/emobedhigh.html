<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>m3u8</title>
<style>
    body, html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-color: black;
    }
    #video-container {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    #video-player {
        width: 100%;
        height: 100%;
        object-fit: contain;
        background-color: black;
    }
    #video-error {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        color: white;
        background-color: red;
        padding: 10px 20px;
        border-radius: 8px;
        display: none;
        font-family: sans-serif;
        z-index: 100;
    }
</style>
</head>
<body>

<div id="video-container">
    <video id="video-player" controls playsinline>
        ブラウザがこの形式の動画ストリームをサポートしていません。
    </video>
</div>
<div id="video-error">⚠ 動画を再生できませんでした。</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
const video = document.getElementById('video-player');
const errorBox = document.getElementById('video-error');

// Flask/Jinja2 から渡された URL
const videoURL = "{{ video_url }}";

function showError() {
    errorBox.style.display = "block";
    console.error("動画再生エラー:", videoURL);
}

// Safari/iOS ネイティブ再生対応
if(video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = videoURL;
    video.play().catch(showError);
} else if(Hls.isSupported()) {
    const hls = new Hls();
    hls.loadSource(videoURL);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, () => {
        video.play().catch(showError);
    });
    hls.on(Hls.Events.ERROR, (event, data) => {
        console.error("HLS.js error:", data);
        showError();
    });
} else {
    // HLS非対応ブラウザ
    showError();
}
</script>

</body>
</html>
